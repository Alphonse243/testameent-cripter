<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Testament Crypté JS</title>
    <script src="crypto.js"></script>
</head>
<body>
    <h1>Chiffrer un testament</h1>
    <form id="encryptForm">
        <label>Réponse 1 : <input type="text" id="a1" required></label><br>
        <label>Réponse 2 : <input type="text" id="a2" required></label><br>
        <label>Réponse 3 : <input type="text" id="a3" required></label><br>
        <label>Message :<br>
            <textarea id="message" rows="5" cols="50" required></textarea>
        </label><br>
        <button type="submit">Crypter</button>
    </form>
    <textarea id="encrypted" rows="5" cols="70" readonly></textarea>
    <button type="button" id="downloadBtn">Télécharger le fichier testament.txt</button>

    <h1>Déchiffrer un testament</h1>
    <form id="decryptForm">
        <label>Réponse 1 : <input type="text" id="da1" required></label><br>
        <label>Réponse 2 : <input type="text" id="da2" required></label><br>
        <label>Réponse 3 : <input type="text" id="da3" required></label><br>
        <label>Testament crypté :<br>
            <textarea id="encryptedInput" rows="5" cols="70" required></textarea>
        </label><br>
        <button type="submit">Décrypter</button>
    </form>
    <textarea id="decrypted" rows="5" cols="70" readonly></textarea>
Lorem ipsum dolor sit amet consectetur adipisicing elit. Earum expedita delectus neque at minima esse sint! Ipsa vero quidem assumenda, odit, fugit voluptatem nam vitae provident tenetur dolor explicabo pariatur.
    <script>
    document.getElementById('encryptForm').onsubmit = async function(e) {
        e.preventDefault();
        const pass = document.getElementById('a1').value + document.getElementById('a2').value + document.getElementById('a3').value;
        const msg = document.getElementById('message').value;
        const encrypted = await encryptTestament(msg, pass);
        document.getElementById('encrypted').value = encrypted;
    };
    document.getElementById('decryptForm').onsubmit = async function(e) {
        e.preventDefault();
        const pass = document.getElementById('da1').value + document.getElementById('da2').value + document.getElementById('da3').value;
        const b64 = document.getElementById('encryptedInput').value;
        const decrypted = await decryptTestament(b64, pass);
        document.getElementById('decrypted').value = decrypted !== false ? decrypted : "Erreur : Mauvaises réponses ou texte corrompu.";
    };

    // Fonction pour générer et télécharger le fichier testament.txt
    document.getElementById('downloadBtn').onclick = async function() {
        // Récupérer les valeurs du formulaire de chiffrement
        const q1 = document.getElementById('a1').form.q1 ? document.getElementById('a1').form.q1.value : "Question 1";
        const q2 = document.getElementById('a2').form.q2 ? document.getElementById('a2').form.q2.value : "Question 2";
        const q3 = document.getElementById('a3').form.q3 ? document.getElementById('a3').form.q3.value : "Question 3";
        const a1 = document.getElementById('a1').value;
        const a2 = document.getElementById('a2').value;
        const a3 = document.getElementById('a3').value;
        const encrypted = document.getElementById('encrypted').value;

        // Chiffrer les réponses (optionnel, ici simple base64 pour la démo)
        // Pour un vrai chiffrement, utilisez la même logique que le message (clé statique)
        function b64(str) { return btoa(unescape(encodeURIComponent(str))); }
        const ea1 = b64(a1);
        const ea2 = b64(a2);
        const ea3 = b64(a3);

        const data = {
            q1: q1,
            q2: q2,
            q3: q3,
            ea1: ea1,
            ea2: ea2,
            ea3: ea3,
            encrypted: encrypted
        };
        const blob = new Blob([JSON.stringify(data)], {type: "text/plain"});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = "testament.txt";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    };
    </script>
</body>
</html>
